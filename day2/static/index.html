<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ERC20 Transfer Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    tr:hover { background-color: #f9f9f9; }
  </style>
</head>
<body>
  <h1>ERC20 Transfer Dashboard</h1>
  <table id="transferTable">
    <thead>
      <tr>
        <th>Contract</th>
        <th>From</th>
        <th>To</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    window.onload = function() {
      const ws = new WebSocket("ws://localhost:8080/ws");
      const tbody = document.querySelector("#transferTable tbody");

      ws.onopen = () => console.log("WebSocket 已连接");
      ws.onclose = () => console.log("WebSocket 已断开");

      ws.onmessage = function(event) {
          const msg = event.data;
          const regex = /(0x[0-9a-fA-F]+) \| From: (0x[0-9a-fA-F]+) To: (0x[0-9a-fA-F]+) Value: ([\d.]+) (\w+)/;
          const match = msg.match(regex);
          if (!match) return;

          const tr = document.createElement("tr");
          tr.innerHTML = `
              <td>${match[1]}</td>
              <td>${match[2]}</td>
              <td>${match[3]}</td>
              <td>${match[4]} ${match[5]}</td>
          `;
          tbody.prepend(tr);

          while (tbody.children.length > 20) {
              tbody.removeChild(tbody.lastChild);
          }
      };
    }
  </script>
</body>
</html>
